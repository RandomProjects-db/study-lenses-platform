<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Animation Libraries</title>
    
    <!-- Anime.js - Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- GSAP - Professional animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- Rete.js - Node-based flow editor -->
    <script src="https://cdn.jsdelivr.net/npm/rete@2.0.3/build/rete.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rete-area-plugin@2.0.3/build/rete-area-plugin.min.js"></script>
    
    <!-- Blockly - Scratch-like blocks -->
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    
    <!-- Framer Motion (needs React) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- React Flow -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/style.min.css">
    <script src="https://cdn.jsdelivr.net/npm/reactflow@11.10.1/dist/umd/index.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .grid-full {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .demo-container {
            min-height: 400px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
            overflow: hidden;
            position: relative;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }
        .btn:hover { background: #764ba2; }
        .pros-cons {
            margin-top: 15px;
            font-size: 14px;
        }
        .pros { color: #48bb78; }
        .cons { color: #f56565; }
        .code-block {
            position: absolute;
            width: 120px;
            height: 60px;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .flow-node {
            width: 100px;
            height: 80px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            position: absolute;
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            user-select: none;
        }
        .flow-node:active {
            cursor: grabbing;
        }
        .flow-node.dragging {
            opacity: 0.7;
            z-index: 1000;
        }
        .connection-line {
            stroke: #999;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
        }
        .timeline {
            width: 100%;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            position: relative;
            margin-top: 20px;
        }
        .playhead {
            width: 4px;
            height: 100%;
            background: #667eea;
            position: absolute;
            left: 0;
            transition: left 0.3s;
        }
        .water-drop {
            width: 20px;
            height: 20px;
            background: #4fc3f7;
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 2px 8px rgba(79, 195, 247, 0.5);
        }
        .pipe {
            stroke: #999;
            stroke-width: 8;
            fill: none;
            stroke-linecap: round;
        }
        .character {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            position: absolute;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .speech-bubble {
            position: absolute;
            background: white;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 14px;
            max-width: 200px;
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }
        .chart-bar {
            fill: #667eea;
            transition: all 0.3s;
        }
        .chart-bar:hover {
            fill: #764ba2;
        }
        .winner {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé¨ Interactive Animation Libraries</h1>
        <p>Animate code execution, drag-drop interactions, and flow-based programming</p>
    </div>

    <div class="grid">
        <!-- Anime.js -->
        <div class="card">
            <h2>üé¨ Anime.js - Step-by-Step Animation</h2>
            <div class="demo-container" id="anime-demo">
                <div class="code-block" id="block1" style="left: 20px; top: 20px;">fib(5)</div>
                <div class="code-block" id="block2" style="left: 20px; top: 100px; opacity: 0;">fib(4)</div>
                <div class="code-block" id="block3" style="left: 20px; top: 180px; opacity: 0;">fib(3)</div>
                <div class="code-block" id="block4" style="left: 20px; top: 260px; opacity: 0;">return 5</div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runAnimeDemo()">‚ñ∂Ô∏è Animate Execution</button>
                <button class="btn" onclick="resetAnime()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Smooth animations, timeline control</div>
                <div class="pros">‚úÖ Perfect for step-by-step execution</div>
                <div class="cons">‚ùå Manual animation setup</div>
            </div>
        </div>

        <!-- GSAP -->
        <div class="card">
            <h2>‚ö° GSAP - Professional Animations</h2>
            <div class="demo-container" id="gsap-demo">
                <svg width="100%" height="350">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#999" />
                        </marker>
                    </defs>
                    <circle id="node1" cx="200" cy="50" r="30" fill="#667eea" stroke="#fff" stroke-width="3"/>
                    <text x="200" y="55" text-anchor="middle" fill="#fff" font-weight="bold">fib(5)</text>
                    
                    <line id="line1" class="connection-line" x1="200" y1="80" x2="150" y2="120" opacity="0"/>
                    <circle id="node2" cx="150" cy="150" r="30" fill="#667eea" stroke="#fff" stroke-width="3" opacity="0"/>
                    <text id="text2" x="150" y="155" text-anchor="middle" fill="#fff" font-weight="bold" opacity="0">fib(4)</text>
                    
                    <line id="line2" class="connection-line" x1="200" y1="80" x2="250" y2="120" opacity="0"/>
                    <circle id="node3" cx="250" cy="150" r="30" fill="#667eea" stroke="#fff" stroke-width="3" opacity="0"/>
                    <text id="text3" x="250" y="155" text-anchor="middle" fill="#fff" font-weight="bold" opacity="0">fib(3)</text>
                </svg>
                <div class="timeline">
                    <div class="playhead" id="gsap-playhead"></div>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runGSAPDemo()">‚ñ∂Ô∏è Animate Tree</button>
                <button class="btn" onclick="resetGSAP()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Industry standard, powerful timeline</div>
                <div class="pros">‚úÖ Scrubbing, playback controls</div>
                <div class="cons">‚ùå Paid for commercial use</div>
            </div>
        </div>

        <!-- Flow-based (Rete.js style) -->
        <div class="card">
            <h2>üåä Flow-Based - Node Editor</h2>
            <div class="demo-container" id="flow-demo">
                <svg width="100%" height="350" id="flow-svg">
                    <defs>
                        <marker id="flow-arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#667eea" />
                        </marker>
                    </defs>
                    <line id="conn1" class="connection-line" x1="120" y1="80" x2="120" y2="150" marker-end="url(#flow-arrow)"/>
                    <line id="conn2" class="connection-line" x1="120" y1="230" x2="120" y2="300" marker-end="url(#flow-arrow)"/>
                    
                    <!-- Animated data packets -->
                    <circle id="packet1" class="water-drop" cx="120" cy="80" r="6" opacity="0"/>
                    <circle id="packet2" class="water-drop" cx="120" cy="230" r="6" opacity="0"/>
                </svg>
                <div class="flow-node" id="flow-input" style="left: 70px; top: 20px;">
                    <div>üì• Input<br><span style="font-size: 20px; color: #667eea;">5</span></div>
                </div>
                <div class="flow-node" id="flow-process" style="left: 70px; top: 150px;">
                    <div>‚öôÔ∏è fibonacci<br><span style="font-size: 12px; opacity: 0.7;">processing...</span></div>
                </div>
                <div class="flow-node" id="flow-output" style="left: 70px; top: 280px;">
                    <div>üì§ Output<br><span style="font-size: 20px; color: #48bb78;">?</span></div>
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runFlowDemo()">üåä Execute Flow</button>
                <button class="btn" onclick="resetFlow()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Visual programming, drag-drop</div>
                <div class="pros">‚úÖ Like Scratch/Node-RED</div>
                <div class="cons">‚ùå Complex setup for custom nodes</div>
            </div>
        </div>

        <!-- Blockly -->
        <div class="card">
            <h2>üß© Blockly - Scratch-Style Blocks</h2>
            <div class="demo-container" id="blockly-demo" style="background: #fff; position: relative;">
                <svg width="100%" height="350">
                    <!-- Simulated Blockly blocks with puzzle piece connectors -->
                    <g id="block-func">
                        <!-- Puzzle piece top -->
                        <path d="M 20,30 L 20,20 L 60,20 L 65,15 L 75,15 L 80,20 L 220,20 L 220,70 L 20,70 Z" fill="#667eea" stroke="#fff" stroke-width="2"/>
                        <text x="90" y="50" fill="#fff" font-weight="bold">function fibonacci(n)</text>
                    </g>
                    <g id="block-if">
                        <path d="M 40,80 L 80,80 L 85,75 L 95,75 L 100,80 L 220,80 L 220,130 L 100,130 L 95,135 L 85,135 L 80,130 L 40,130 Z" fill="#48bb78" stroke="#fff" stroke-width="2"/>
                        <text x="110" y="110" fill="#fff" font-weight="bold">if n ‚â§ 1</text>
                    </g>
                    <g id="block-return1">
                        <path d="M 60,140 L 100,140 L 105,135 L 115,135 L 120,140 L 220,140 L 220,190 L 120,190 L 115,195 L 105,195 L 100,190 L 60,190 Z" fill="#f56565" stroke="#fff" stroke-width="2"/>
                        <text x="130" y="170" fill="#fff" font-weight="bold">return n</text>
                        <!-- Glow effect -->
                        <circle id="glow1" cx="140" cy="165" r="40" fill="#f56565" opacity="0"/>
                    </g>
                    <g id="block-else">
                        <path d="M 40,200 L 80,200 L 85,195 L 95,195 L 100,200 L 220,200 L 220,250 L 100,250 L 95,255 L 85,255 L 80,250 L 40,250 Z" fill="#48bb78" stroke="#fff" stroke-width="2"/>
                        <text x="110" y="230" fill="#fff" font-weight="bold">else</text>
                    </g>
                    <g id="block-return2">
                        <path d="M 60,260 L 100,260 L 105,255 L 115,255 L 120,260 L 220,260 L 220,310 L 60,310 Z" fill="#f56565" stroke="#fff" stroke-width="2"/>
                        <text x="70" y="290" fill="#fff" font-size="11" font-weight="bold">return fib(n-1) + fib(n-2)</text>
                        <!-- Glow effect -->
                        <circle id="glow2" cx="140" cy="285" r="40" fill="#f56565" opacity="0"/>
                    </g>
                </svg>
                <!-- Execution indicator -->
                <div id="block-indicator" style="position: absolute; top: 20px; right: 20px; background: #667eea; color: white; padding: 10px 15px; border-radius: 8px; font-weight: bold; opacity: 0;">
                    ‚ñ∂Ô∏è Executing...
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runBlocklyExecution()">üß© Execute Blocks</button>
                <button class="btn" onclick="resetBlockly()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Beginner-friendly, visual coding</div>
                <div class="pros">‚úÖ Google-maintained, proven</div>
                <div class="cons">‚ùå Heavy (~500KB), complex API</div>
            </div>
        </div>
    </div>

    <!-- New Section: More Visual Styles -->
    <h2 style="text-align: center; color: #667eea; margin: 40px 0 20px;">More Visual Approaches</h2>

    <div class="grid">
        <!-- Water Flow Metaphor -->
        <div class="card">
            <h2>üíß Water Flow - Data Flow Metaphor</h2>
            <div class="demo-container" id="water-demo">
                <svg width="100%" height="350">
                    <!-- Pipes -->
                    <path class="pipe" d="M 50 50 L 200 50" stroke-dasharray="10,5"/>
                    <path class="pipe" d="M 200 50 L 200 150"/>
                    <path class="pipe" d="M 200 150 L 350 150"/>
                    <path class="pipe" d="M 350 150 L 350 250"/>
                    
                    <!-- Containers -->
                    <rect x="20" y="20" width="60" height="60" fill="#667eea" rx="8"/>
                    <text x="50" y="55" text-anchor="middle" fill="#fff" font-weight="bold">Input</text>
                    
                    <rect x="170" y="120" width="60" height="60" fill="#667eea" rx="8"/>
                    <text x="200" y="155" text-anchor="middle" fill="#fff" font-weight="bold">Process</text>
                    
                    <rect x="320" y="220" width="60" height="60" fill="#48bb78" rx="8"/>
                    <text x="350" y="255" text-anchor="middle" fill="#fff" font-weight="bold">Output</text>
                    
                    <!-- Water drops -->
                    <circle id="drop1" class="water-drop" cx="50" cy="50" r="8" opacity="0"/>
                    <circle id="drop2" class="water-drop" cx="50" cy="50" r="8" opacity="0"/>
                    <circle id="drop3" class="water-drop" cx="50" cy="50" r="8" opacity="0"/>
                </svg>
            </div>
            <div class="controls">
                <button class="btn" onclick="runWaterFlow()">üíß Flow Data</button>
                <button class="btn" onclick="resetWater()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Intuitive metaphor for data flow</div>
                <div class="pros">‚úÖ Great for beginners</div>
                <div class="cons">‚ùå Limited to sequential flow</div>
            </div>
        </div>

        <!-- Story-based Characters -->
        <div class="card">
            <h2>üé≠ Story Mode - Characters & Dialogue</h2>
            <div class="demo-container" id="story-demo">
                <div class="character" id="char1" style="left: 50px; top: 50px;">ü§ñ</div>
                <div class="speech-bubble" id="bubble1" style="left: 120px; top: 50px; opacity: 0;">
                    I need to calculate fibonacci(5)!
                </div>
                
                <div class="character" id="char2" style="left: 50px; top: 180px; opacity: 0;">üßÆ</div>
                <div class="speech-bubble" id="bubble2" style="left: 120px; top: 180px; opacity: 0;">
                    Let me break it down: fib(4) + fib(3)
                </div>
                
                <div class="character" id="char3" style="left: 50px; top: 280px; opacity: 0;">‚úÖ</div>
                <div class="speech-bubble" id="bubble3" style="left: 120px; top: 280px; opacity: 0;">
                    The answer is 5!
                </div>
            </div>
            <div class="controls">
                <button class="btn" onclick="runStory()">üé≠ Play Story</button>
                <button class="btn" onclick="resetStory()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Engaging, memorable</div>
                <div class="pros">‚úÖ Great for young learners</div>
                <div class="cons">‚ùå Can be distracting</div>
            </div>
        </div>

        <!-- Data Visualization Charts -->
        <div class="card">
            <h2>üìä Data Viz - Call Count Charts</h2>
            <div class="demo-container" id="chart-demo">
                <svg width="100%" height="350">
                    <!-- Bar chart showing function call counts -->
                    <text x="20" y="30" font-weight="bold" fill="#667eea">Function Call Frequency</text>
                    
                    <!-- Axes -->
                    <line x1="50" y1="300" x2="450" y2="300" stroke="#999" stroke-width="2"/>
                    <line x1="50" y1="50" x2="50" y2="300" stroke="#999" stroke-width="2"/>
                    
                    <!-- Bars -->
                    <rect class="chart-bar" id="bar1" x="80" y="100" width="60" height="200" rx="4"/>
                    <text x="110" y="320" text-anchor="middle" font-size="12">fib(5)</text>
                    <text x="110" y="90" text-anchor="middle" font-weight="bold" fill="#667eea">1</text>
                    
                    <rect class="chart-bar" id="bar2" x="160" y="150" width="60" height="150" rx="4"/>
                    <text x="190" y="320" text-anchor="middle" font-size="12">fib(4)</text>
                    <text x="190" y="140" text-anchor="middle" font-weight="bold" fill="#667eea">1</text>
                    
                    <rect class="chart-bar" id="bar3" x="240" y="180" width="60" height="120" rx="4"/>
                    <text x="270" y="320" text-anchor="middle" font-size="12">fib(3)</text>
                    <text x="270" y="170" text-anchor="middle" font-weight="bold" fill="#667eea">2</text>
                    
                    <rect class="chart-bar" id="bar4" x="320" y="220" width="60" height="80" rx="4"/>
                    <text x="350" y="320" text-anchor="middle" font-size="12">fib(2)</text>
                    <text x="350" y="210" text-anchor="middle" font-weight="bold" fill="#667eea">3</text>
                    
                    <rect class="chart-bar" id="bar5" x="400" y="240" width="60" height="60" rx="4"/>
                    <text x="430" y="320" text-anchor="middle" font-size="12">fib(1)</text>
                    <text x="430" y="230" text-anchor="middle" font-weight="bold" fill="#667eea">5</text>
                </svg>
            </div>
            <div class="controls">
                <button class="btn" onclick="animateChart()">üìä Animate Chart</button>
                <button class="btn" onclick="resetChart()">üîÑ Reset</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Shows patterns, inefficiencies</div>
                <div class="pros">‚úÖ Good for analysis</div>
                <div class="cons">‚ùå Less intuitive for beginners</div>
            </div>
        </div>

        <!-- React Flow -->
        <div class="card">
            <h2>üî∑ React Flow - Professional Node Editor</h2>
            <div class="demo-container" id="reactflow-demo" style="height: 450px; background: #fafafa;"></div>
            <div class="controls">
                <button class="btn" onclick="alert('Drag nodes, zoom with scroll, pan by dragging background')">üéÆ Interact</button>
            </div>
            <div class="pros-cons">
                <div class="pros">‚úÖ Professional, feature-rich</div>
                <div class="pros">‚úÖ Drag, zoom, pan, connect nodes</div>
                <div class="cons">‚ùå Requires React, ~200KB</div>
            </div>
        </div>
    </div>

    <div class="winner">
        <h2>üéØ Best for Your Use Case</h2>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
            <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; text-align: left;">
                <h3 style="color: #667eea; margin-bottom: 10px;">üé¨ For Animations</h3>
                <p><strong>Anime.js</strong> - Lightweight, perfect for step-by-step execution visualization</p>
                <p style="margin-top: 10px; font-size: 14px; color: #666;">~20KB, works offline, LLM can generate animation sequences</p>
            </div>
            <div style="background: #f0f9ff; padding: 20px; border-radius: 12px; text-align: left;">
                <h3 style="color: #667eea; margin-bottom: 10px;">üåä For Flow-Based</h3>
                <p><strong>React Flow</strong> - Modern, interactive node editor with drag-drop</p>
                <p style="margin-top: 10px; font-size: 14px; color: #666;">~200KB, works offline, great for visual programming</p>
            </div>
        </div>
    </div>

    <script>
        // Anime.js Demo
        function runAnimeDemo() {
            anime.timeline()
                .add({
                    targets: '#block1',
                    translateX: 200,
                    duration: 800,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#block2',
                    opacity: 1,
                    translateX: 200,
                    duration: 800,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#block3',
                    opacity: 1,
                    translateX: 200,
                    duration: 800,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#block4',
                    opacity: 1,
                    translateX: 200,
                    backgroundColor: '#48bb78',
                    duration: 800,
                    easing: 'easeInOutQuad'
                });
        }

        function resetAnime() {
            anime({
                targets: '.code-block',
                translateX: 0,
                opacity: (el, i) => i === 0 ? 1 : 0,
                backgroundColor: '#667eea',
                duration: 500
            });
        }

        // GSAP Demo
        function runGSAPDemo() {
            const tl = gsap.timeline();
            
            tl.to('#gsap-playhead', { left: '0%', duration: 0 })
              .to('#line1', { opacity: 1, duration: 0.5 })
              .to(['#node2', '#text2'], { opacity: 1, duration: 0.5 })
              .to('#gsap-playhead', { left: '33%', duration: 0.5 }, '<')
              .to('#line2', { opacity: 1, duration: 0.5 })
              .to(['#node3', '#text3'], { opacity: 1, duration: 0.5 })
              .to('#gsap-playhead', { left: '66%', duration: 0.5 }, '<')
              .to(['#node2', '#node3'], { fill: '#48bb78', duration: 0.5 })
              .to('#gsap-playhead', { left: '100%', duration: 0.5 }, '<');
        }

        function resetGSAP() {
            gsap.set(['#line1', '#line2', '#node2', '#node3', '#text2', '#text3'], { opacity: 0 });
            gsap.set(['#node2', '#node3'], { fill: '#667eea' });
            gsap.set('#gsap-playhead', { left: '0%' });
        }

        // Make flow nodes draggable (improved)
        let draggedNode = null;
        let offsetX = 0;
        let offsetY = 0;

        document.querySelectorAll('.flow-node').forEach(node => {
            node.addEventListener('mousedown', (e) => {
                draggedNode = node;
                node.classList.add('dragging');
                const rect = node.getBoundingClientRect();
                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;
                e.preventDefault();
            });
        });

        document.addEventListener('mousemove', (e) => {
            if (draggedNode) {
                const container = draggedNode.parentElement.getBoundingClientRect();
                let newX = e.clientX - container.left - offsetX;
                let newY = e.clientY - container.top - offsetY;
                
                // Keep within bounds
                newX = Math.max(0, Math.min(newX, container.width - 100));
                newY = Math.max(0, Math.min(newY, container.height - 80));
                
                draggedNode.style.left = newX + 'px';
                draggedNode.style.top = newY + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            if (draggedNode) {
                draggedNode.classList.remove('dragging');
                draggedNode = null;
            }
        });

        // Blockly animation - improved
        function runBlocklyExecution() {
            anime.timeline()
                .add({
                    targets: '#block-indicator',
                    opacity: 1,
                    duration: 300
                })
                .add({
                    targets: '#block-func',
                    translateX: [0, 10, 0],
                    duration: 400,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#block-if',
                    translateX: [0, 10, 0],
                    duration: 400,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: ['#block-return1', '#glow1'],
                    translateX: [0, 10, 0],
                    opacity: [null, 0.3, 0],
                    duration: 600,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#block-indicator',
                    opacity: 0,
                    duration: 300
                });
        }

        function resetBlockly() {
            anime.set(['#block-func', '#block-if', '#block-else', '#block-return1', '#block-return2'], {
                translateX: 0
            });
            anime.set(['#glow1', '#glow2', '#block-indicator'], { opacity: 0 });
        }

        // Flow demo - improved
        function runFlowDemo() {
            anime.timeline()
                .add({
                    targets: '#flow-input',
                    scale: [1, 1.1, 1],
                    duration: 400
                })
                .add({
                    targets: '#packet1',
                    opacity: [0, 1],
                    cy: [80, 150],
                    duration: 800,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#flow-process',
                    scale: [1, 1.1, 1],
                    rotate: [0, 360],
                    duration: 1000,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#packet1',
                    opacity: 0,
                    duration: 200
                })
                .add({
                    targets: '#packet2',
                    opacity: [0, 1],
                    cy: [230, 300],
                    duration: 800,
                    easing: 'easeInOutQuad'
                })
                .add({
                    targets: '#flow-output',
                    scale: [1, 1.2, 1],
                    duration: 400
                })
                .add({
                    targets: '#packet2',
                    opacity: 0,
                    duration: 200
                })
                .add({
                    targets: '#flow-output',
                    innerHTML: '<div>üì§ Output<br><span style="font-size: 20px; color: #48bb78;">5</span></div>',
                    duration: 1
                });
        }

        function resetFlow() {
            anime.set(['#flow-input', '#flow-process', '#flow-output'], { scale: 1, rotate: 0 });
            anime.set(['#packet1', '#packet2'], { opacity: 0, cy: (el) => el.id === 'packet1' ? 80 : 230 });
            document.getElementById('flow-output').innerHTML = '<div>üì§ Output<br><span style="font-size: 20px; color: #48bb78;">?</span></div>';
        }

        // Water flow animation
        function runWaterFlow() {
            anime.timeline()
                .add({
                    targets: '#drop1',
                    opacity: 1,
                    cx: [50, 200],
                    cy: [50, 50],
                    duration: 1000,
                    easing: 'linear'
                })
                .add({
                    targets: '#drop1',
                    cy: [50, 150],
                    duration: 800,
                    easing: 'linear'
                })
                .add({
                    targets: '#drop1',
                    cx: [200, 350],
                    cy: [150, 150],
                    duration: 1000,
                    easing: 'linear'
                })
                .add({
                    targets: '#drop1',
                    cy: [150, 250],
                    duration: 800,
                    easing: 'linear'
                })
                .add({
                    targets: '#drop1',
                    opacity: 0,
                    scale: 1.5,
                    duration: 300
                });
        }

        function resetWater() {
            anime.set(['#drop1', '#drop2', '#drop3'], {
                opacity: 0,
                cx: 50,
                cy: 50,
                scale: 1
            });
        }

        // Story animation
        function runStory() {
            anime.timeline()
                .add({
                    targets: '#bubble1',
                    opacity: 1,
                    translateX: [20, 0],
                    duration: 500
                })
                .add({
                    targets: ['#char2', '#bubble2'],
                    opacity: 1,
                    translateY: [-20, 0],
                    duration: 500,
                    delay: anime.stagger(100)
                }, '+=1000')
                .add({
                    targets: ['#char3', '#bubble3'],
                    opacity: 1,
                    translateY: [-20, 0],
                    duration: 500,
                    delay: anime.stagger(100)
                }, '+=1000');
        }

        function resetStory() {
            anime.set(['#char2', '#char3', '#bubble1', '#bubble2', '#bubble3'], {
                opacity: 0,
                translateX: 0,
                translateY: 0
            });
        }

        // Chart animation
        function animateChart() {
            anime({
                targets: '.chart-bar',
                height: [0, (el) => el.getAttribute('height')],
                duration: 1000,
                delay: anime.stagger(200),
                easing: 'easeOutElastic(1, .8)'
            });
        }

        function resetChart() {
            anime.set('.chart-bar', { height: 0 });
        }

        // React Flow initialization
        const { ReactFlow, Background, Controls } = window.ReactFlow || {};
        
        if (ReactFlow) {
            const initialNodes = [
                { id: '1', position: { x: 150, y: 50 }, data: { label: 'fib(5)' }, style: { background: '#667eea', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '2', position: { x: 50, y: 150 }, data: { label: 'fib(4)' }, style: { background: '#667eea', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '3', position: { x: 250, y: 150 }, data: { label: 'fib(3)' }, style: { background: '#667eea', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '4', position: { x: 20, y: 250 }, data: { label: 'fib(3)' }, style: { background: '#667eea', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '5', position: { x: 120, y: 250 }, data: { label: 'fib(2)' }, style: { background: '#667eea', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '6', position: { x: 220, y: 250 }, data: { label: 'fib(1)' }, style: { background: '#48bb78', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } },
                { id: '7', position: { x: 320, y: 250 }, data: { label: 'fib(0)' }, style: { background: '#48bb78', color: '#fff', fontWeight: 'bold', padding: 10, borderRadius: 8 } }
            ];

            const initialEdges = [
                { id: 'e1-2', source: '1', target: '2', animated: true },
                { id: 'e1-3', source: '1', target: '3', animated: true },
                { id: 'e2-4', source: '2', target: '4', animated: true },
                { id: 'e2-5', source: '2', target: '5', animated: true },
                { id: 'e3-6', source: '3', target: '6', animated: true },
                { id: 'e3-7', source: '3', target: '7', animated: true }
            ];

            const FlowComponent = () => {
                const [nodes, setNodes] = React.useState(initialNodes);
                const [edges, setEdges] = React.useState(initialEdges);

                return React.createElement(ReactFlow, {
                    nodes,
                    edges,
                    onNodesChange: (changes) => setNodes((nds) => window.ReactFlow.applyNodeChanges(changes, nds)),
                    onEdgesChange: (changes) => setEdges((eds) => window.ReactFlow.applyEdgeChanges(changes, eds)),
                    fitView: true,
                    children: [
                        React.createElement(Background),
                        React.createElement(Controls)
                    ]
                });
            };

            const root = ReactDOM.createRoot(document.getElementById('reactflow-demo'));
            root.render(React.createElement(FlowComponent));
        }
    </script>
</body>
</html>
